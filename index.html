<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MangaTH - เว็บอ่านมังงะ</title>
    <style>
        /* Reset และฟอนต์พื้นฐาน */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans Thai', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background-color: #1a1a1a;
            color: #f0f0f0;
        }

        /* Header */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        header.hidden {
            transform: translateY(-100%);
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        .settings-button {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .settings-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .search-container {
            display: flex;
            width: 100%;
            max-width: 600px;
        }

        .search-input {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }

        .search-button {
            padding: 0.5rem 1rem;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 1rem;
        }

        nav {
            display: flex;
            justify-content: center;
            padding: 0.5rem 0;
            background-color: #34495e;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover {
            background-color: #e74c3c;
        }

        /* Main Content */
        main {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            min-height: calc(100vh - 180px);
        }

        /* หน้าหลัก */
        .section-title {
            margin: 1.5rem 0;
            color: #2c3e50;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 0.5rem;
        }

        .dark-mode .section-title {
            color: #f0f0f0;
            border-bottom-color: #e74c3c;
        }

        .manga-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .manga-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .dark-mode .manga-card {
            background: #2c3e50;
            color: #f0f0f0;
        }

        .manga-card:hover {
            transform: translateY(-5px);
        }

        .manga-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .manga-card h3 {
            padding: 0.5rem;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .manga-card p {
            padding: 0 0.5rem 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        .dark-mode .manga-card p {
            color: #ccc;
        }

        /* หน้าอ่านมังงะ */
        .reader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 1rem 0;
            position: sticky;
            top: 60px;
            background-color: #f8f9fa;
            z-index: 90;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

        .dark-mode .chapter-nav {
            background-color: #2c3e50;
            color: white;
        }

        .chapter-nav.hidden {
            transform: translateY(-100%);
        }

        .chapter-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chapter-select {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: white;
        }

        .dark-mode .chapter-select {
            background-color: #34495e;
            color: white;
            border-color: #555;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .nav-button:hover {
            background-color: #e74c3c;
        }

        .nav-button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .chapter-title {
            text-align: center;
            margin: 0.5rem 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .dark-mode .chapter-title {
            color: #f0f0f0;
        }

        .page-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
            position: relative;
        }

        .manga-page {
            max-width: 100%;
            height: auto;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 4px;
            display: none;
            position: relative;
        }

        /* สไตล์สำหรับโหมด Webtoon */
        .webtoon-mode .manga-page {
            display: block;
            margin-bottom: 0;
            border-radius: 0;
            box-shadow: none;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .webtoon-mode .manga-page {
            border-bottom-color: #444;
        }

        .webtoon-mode .page-controls {
            display: none;
        }

        .webtoon-mode .page-info {
            display: none;
        }

        .page-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .page-info {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 1rem;
        }

        .dark-mode .page-info {
            color: #aaa;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #666;
        }

        .dark-mode .loading {
            color: #aaa;
        }

        .reader-loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #666;
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            width: 200px;
        }

        .dark-mode .reader-loading {
            background: rgba(44, 62, 80, 0.8);
            color: #f0f0f0;
        }

        /* Loading สำหรับแต่ละรูปภาพในโหมด Webtoon */
        .page-loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            z-index: 10;
        }

        .dark-mode .page-loading {
            background: rgba(0, 0, 0, 0.7);
        }

        /* Search Results */
        .search-results {
            margin: 1rem 0;
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .dark-mode .search-results {
            background-color: #2c3e50;
        }

        /* หน้ารายละเอียดมังงะ */
        .manga-details-section {
            display: none;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        .dark-mode .manga-details-section {
            background-color: #2c3e50;
        }

        .manga-details-header {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .manga-details-header {
                flex-direction: row;
            }
        }

        .manga-cover {
            flex: 0 0 250px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .manga-cover img {
            width: 100%;
            height: auto;
            display: block;
        }

        .manga-info {
            flex: 1;
        }

        .manga-title {
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        .dark-mode .manga-title {
            color: #f0f0f0;
        }

        .manga-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            color: #7f8c8d;
        }

        .dark-mode .manga-meta {
            color: #aaa;
        }

        .manga-description {
            margin-bottom: 1.5rem;
            line-height: 1.7;
        }

        .chapter-list {
            margin-top: 2rem;
        }

        .chapter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .dark-mode .chapter-item {
            border-bottom-color: #444;
        }

        .chapter-item:hover {
            background-color: #f8f9fa;
        }

        .dark-mode .chapter-item:hover {
            background-color: #34495e;
        }

        .chapter-item-title {
            font-weight: bold;
        }

        .chapter-item-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .dark-mode .chapter-item-date {
            color: #aaa;
        }

        .read-button {
            padding: 0.5rem 1rem;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .read-button:hover {
            background-color: #c0392b;
        }

        /* หน้าประวัติการอ่าน */
        .history-time {
            font-size: 0.7rem;
            color: #7f8c8d;
            padding: 0 0.5rem 0.5rem;
        }

        .dark-mode .history-time {
            color: #aaa;
        }

        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        /* ปุ่มควบคุม Reader */
        .reader-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .reader-control-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #2c3e50;
            color: white;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .reader-control-button:hover {
            background-color: #e74c3c;
            transform: scale(1.1);
        }

        /* แถบความคืบหน้า */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background-color: #f0f0f0;
            z-index: 99;
        }

        .dark-mode .progress-container {
            background-color: #333;
        }

        .progress-bar {
            height: 100%;
            background-color: #e74c3c;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* เมนูตั้งค่า */
        .settings-menu {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 300px;
            max-width: 90%;
            background-color: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            z-index: 110;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            padding: 1rem;
            overflow-y: auto;
        }

        .dark-mode .settings-menu {
            background-color: #2c3e50;
            color: white;
        }

        .settings-menu.show {
            transform: translateX(0);
        }

        .settings-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .settings-menu-header {
            border-bottom-color: #444;
        }

        .settings-menu-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .dark-mode .close-settings {
            color: #aaa;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group-title {
            font-weight: bold;
            margin-bottom: 0.8rem;
            color: #2c3e50;
        }

        .dark-mode .settings-group-title {
            color: #f0f0f0;
        }

        .settings-option {
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
        }

        .settings-option label {
            margin-left: 0.5rem;
            cursor: pointer;
        }

        .dark-mode .settings-option label {
            color: #f0f0f0;
        }

        .settings-description {
            font-size: 0.8rem;
            color: #666;
            margin-left: 1.8rem;
            margin-top: -0.5rem;
            margin-bottom: 0.5rem;
        }

        .dark-mode .settings-description {
            color: #aaa;
        }

        .font-size-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .font-size-btn {
            padding: 0.3rem 0.6rem;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .font-size-btn:hover {
            background-color: #e74c3c;
        }

        /* Responsive */
        @media (max-width: 768px) {
            main {
                padding: 0.5rem;
            }
            
            .manga-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .chapter-nav {
                top: 56px;
                padding: 0.5rem 0;
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .chapter-controls {
                justify-content: space-between;
                width: 100%;
            }
            
            .nav-button {
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            
            .chapter-title {
                font-size: 1rem;
                order: -1;
            }

            .manga-details-header {
                flex-direction: column;
            }

            .manga-cover {
                flex: 0 0 auto;
                max-width: 100%;
            }

            .settings-button {
                position: static;
                transform: none;
                margin-right: auto;
                margin-bottom: 0.5rem;
            }

            .reader-control-button {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }

        /* Animation สำหรับ Auto Scroll */
        @keyframes autoScroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        .auto-scroll-active {
            animation: autoScroll 60s linear infinite;
        }

        /* ลูกศรยืนยันเปลี่ยนตอน */
        .chapter-confirm {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background-color: rgba(231, 76, 60, 0.9);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 95;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }
        
        .chapter-confirm.show {
            opacity: 1;
        }
        
        .chapter-confirm-text {
            color: white;
            font-size: 0.8rem;
            text-align: center;
            margin-bottom: 5px;
            width: 100%;
        }
        
        .chapter-confirm-arrow {
            color: white;
            font-size: 2rem;
            transition: transform 0.5s ease;
        }
        
        /* วงกลมแสดงความคืบหน้า */
        .confirm-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: white;
            transform: rotate(0deg);
            transition: transform 0.3s ease;
        }
        
        /* เพิ่ม animation สำหรับการหมุน */
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .rotate-animation {
            animation: rotate 0.5s linear forwards;
        }

        /* Network status */
        .network-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 15px;
            background-color: #e74c3c;
            color: white;
            border-radius: 20px;
            z-index: 100;
            display: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .network-status.online {
            background-color: #2ecc71;
        }
    </style>
</head>
<body>
    <!-- แถบความคืบหน้า -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Network status indicator -->
    <div class="network-status" id="networkStatus">
        ไม่มีการเชื่อมต่ออินเทอร์เน็ต
    </div>

    <header>
        <div class="header-content">
            <button class="settings-button" id="settingsButton">⚙️</button>
            <h1>MangaTH</h1>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="ค้นหามังงะ...">
                <button id="searchButton" class="search-button">ค้นหา</button>
            </div>
        </div>
        <nav>
            <a href="#" id="homeLink">หน้าแรก</a>
            <a href="#" id="allMangaLink">มังงะทั้งหมด</a>
            <a href="#" id="historyLink">ประวัติการอ่าน</a>
        </nav>
    </header>

    <main id="mainContent">
        <!-- หน้าแรก -->
        <section id="homeSection">
            <h2 class="section-title">เรื่องแนะนำ</h2>
            <div class="manga-grid" id="featuredManga">
                <div class="loading">กำลังโหลดข้อมูล...</div>
            </div>

            <h2 class="section-title">อัปเดตล่าสุด</h2>
            <div class="manga-grid" id="recentUpdates">
                <div class="loading">กำลังโหลดข้อมูล...</div>
            </div>
        </section>

        <!-- หน้ามังงะทั้งหมด -->
        <section id="allMangaSection" style="display: none;">
            <h2 class="section-title">มังงะทั้งหมด</h2>
            <div class="manga-grid" id="allMangaList">
                <div class="loading">กำลังโหลดข้อมูล...</div>
            </div>
        </section>

        <!-- ผลการค้นหา -->
        <section id="searchResultsSection" style="display: none;">
            <h2 class="section-title">ผลการค้นหา</h2>
            <div id="searchResultsContainer"></div>
        </section>

        <!-- หน้ารายละเอียดมังงะ -->
        <section id="mangaDetailsSection" class="manga-details-section">
            <div class="manga-details-header">
                <div class="manga-cover">
                    <img id="mangaDetailCover" src="" alt="ภาพปกมังงะ" onerror="this.src='https://via.placeholder.com/250x350?text=No+Cover'">
                </div>
                <div class="manga-info">
                    <h1 class="manga-title" id="mangaDetailTitle">ชื่อมังงะ</h1>
                    <div class="manga-meta">
                        <span id="mangaDetailAuthor">ผู้แต่ง: -</span>
                        <span id="mangaDetailStatus">สถานะ: -</span>
                        <span id="mangaDetailGenre">ประเภท: -</span>
                    </div>
                    <div class="manga-description" id="mangaDetailDescription">
                        ไม่มีรายละเอียด
                    </div>
                </div>
            </div>

            <div class="chapter-list">
                <h2 class="section-title">ตอนทั้งหมด</h2>
                <div id="chapterListContainer">
                    <div class="loading">กำลังโหลดข้อมูล...</div>
                </div>
            </div>
        </section>

        <!-- หน้าอ่านมังงะ -->
        <section id="readerSection" style="display: none;">
            <div class="reader-container">
                <div class="chapter-nav" id="chapterNav">
                    <div class="chapter-controls">
                        <button id="prevChapterBtn" class="nav-button">← ตอนก่อนหน้า</button>
                        <select id="chapterSelect" class="chapter-select">
                            <option value="">เลือกตอน...</option>
                        </select>
                        <button id="nextChapterBtn" class="nav-button">ตอนถัดไป →</button>
                    </div>
                    <h2 class="chapter-title" id="chapterTitle">ชื่อตอน</h2>
                </div>

                <div class="page-info" id="pageInfo">หน้า 1/10</div>
                
                <div class="page-container" id="pageContainer">
                    <div class="reader-loading" id="readerLoading">กำลังดาวน์โหลด...</div>
                    <img id="mangaPage" class="manga-page" src="" alt="หน้ามังงะ" onerror="this.onerror=null;this.src='https://via.placeholder.com/800x1200?text=ไม่พบภาพ';checkNetworkStatus();">
                </div>

                <div class="page-controls">
                    <button id="prevPageBtn" class="nav-button">← หน้าก่อน</button>
                    <button id="nextPageBtn" class="nav-button">หน้าถัดไป →</button>
                </div>
            </div>

            <!-- ปุ่มควบคุม Reader -->
            <div class="reader-controls" id="readerControls">
                <button class="reader-control-button" id="scrollToTopBtn">↑</button>
                <button class="reader-control-button" id="toggleSettingsBtn">⚙️</button>
            </div>

            <!-- ลูกศรยืนยันเปลี่ยนตอน -->
            <div class="chapter-confirm" id="chapterConfirm">
                <div class="confirm-progress" id="confirmProgress"></div>
                <div class="chapter-confirm-text">เลื่อนลงเพื่อไปตอนถัดไป</div>
                <div class="chapter-confirm-arrow" id="confirmArrow">↓</div>
            </div>

            <!-- เมนูตั้งค่า -->
            <div class="settings-menu" id="settingsMenu">
                <div class="settings-menu-header">
                    <h3 class="settings-menu-title">การตั้งค่า</h3>
                    <button class="close-settings" id="closeSettings">&times;</button>
                </div>
                
                <div class="settings-group">
                    <h4 class="settings-group-title">โหมดการอ่าน</h4>
                    <div class="settings-option">
                        <input type="radio" id="menuPageMode" name="menuReadingMode" value="page">
                        <label for="menuPageMode">โหมดทีละหน้า</label>
                    </div>
                    <div class="settings-option">
                        <input type="radio" id="menuWebtoonMode" name="menuReadingMode" value="webtoon">
                        <label for="menuWebtoonMode">โหมดเว็บตูน</label>
                    </div>
                    <div class="settings-description">
                        โหมดทีละหน้าสำหรับมังงะทั่วไป, โหมดเว็บตูนสำหรับการเลื่อนอ่านแบบต่อเนื่อง
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4 class="settings-group-title">ธีมสี</h4>
                    <div class="settings-option">
                        <input type="radio" id="lightMode" name="colorMode" value="light">
                        <label for="lightMode">โหมดกลางวัน</label>
                    </div>
                    <div class="settings-option">
                        <input type="radio" id="darkMode" name="colorMode" value="dark">
                        <label for="darkMode">โหมดกลางคืน</label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4 class="settings-group-title">ขนาดตัวอักษร</h4>
                    <div class="font-size-controls">
                        <button id="fontSizeDecrease" class="font-size-btn">A-</button>
                        <span id="currentFontSize">16px</span>
                        <button id="fontSizeIncrease" class="font-size-btn">A+</button>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4 class="settings-group-title">ตัวเลือกอื่นๆ</h4>
                    <div class="settings-option">
                        <input type="checkbox" id="autoScrollCheckbox" name="autoScroll">
                        <label for="autoScrollCheckbox">เลื่อนอัตโนมัติ</label>
                    </div>
                    <div class="settings-option">
                        <input type="checkbox" id="hideHeaderCheckbox" name="hideHeader">
                        <label for="hideHeaderCheckbox">ซ่อนแถบด้านบนเมื่ออ่าน</label>
                    </div>
                </div>
            </div>
        </section>

        <!-- หน้าประวัติการอ่าน -->
        <section id="historySection" style="display: none;">
            <h2 class="section-title">ประวัติการอ่าน</h2>
            <div class="manga-grid" id="historyList">
                <div class="loading">กำลังโหลดประวัติ...</div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 MangaTH - เว็บอ่านมังงะ</p>
    </footer>

    <script>
        // กำหนดค่า GitHub Repository
        const GITHUB_USERNAME = 'Anawin870';
        const GITHUB_REPO = 'Webmanga2';
        const DATA_FILE = 'manga-data.json';
        
        // URL สำหรับดึงข้อมูล
        const RAW_DATA_URL = `https://raw.githubusercontent.com/Anawin870/Webmanga2/refs/heads/main/manga-data.json`;
        
        // ตัวแปรเก็บข้อมูล
        let mangaData = [];
        let currentManga = null;
        let currentChapterIndex = 0;
        let currentPageIndex = 0;
        let searchResults = [];
        let readingMode = 'page';
        let isHeaderVisible = true;
        let scrollTimeout = null;
        let autoScrollInterval = null;
        let isAutoScrolling = false;
        let isConfirming = false;
        let confirmProgress = 0;
        const confirmThreshold = 100; // ระยะที่ต้องเลื่อนเพื่อยืนยัน
        let startY = 0;
        let isOnline = navigator.onLine;

        // DOM Elements
        const homeLink = document.getElementById('homeLink');
        const allMangaLink = document.getElementById('allMangaLink');
        const historyLink = document.getElementById('historyLink');
        const homeSection = document.getElementById('homeSection');
        const allMangaSection = document.getElementById('allMangaSection');
        const historySection = document.getElementById('historySection');
        const searchResultsSection = document.getElementById('searchResultsSection');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const mangaDetailsSection = document.getElementById('mangaDetailsSection');
        const readerSection = document.getElementById('readerSection');
        const featuredManga = document.getElementById('featuredManga');
        const recentUpdates = document.getElementById('recentUpdates');
        const allMangaList = document.getElementById('allMangaList');
        const historyList = document.getElementById('historyList');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const chapterTitle = document.getElementById('chapterTitle');
        let mangaPage = document.getElementById('mangaPage');
        const pageInfo = document.getElementById('pageInfo');
        const prevChapterBtn = document.getElementById('prevChapterBtn');
        const nextChapterBtn = document.getElementById('nextChapterBtn');
        const chapterSelect = document.getElementById('chapterSelect');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const readerLoading = document.getElementById('readerLoading');
        const settingsButton = document.getElementById('settingsButton');
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        const chapterNav = document.getElementById('chapterNav');
        const readerControls = document.getElementById('readerControls');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const toggleSettingsBtn = document.getElementById('toggleSettingsBtn');
        const settingsMenu = document.getElementById('settingsMenu');
        const closeSettings = document.getElementById('closeSettings');
        const menuPageMode = document.getElementById('menuPageMode');
        const menuWebtoonMode = document.getElementById('menuWebtoonMode');
        const lightMode = document.getElementById('lightMode');
        const darkMode = document.getElementById('darkMode');
        const fontSizeDecrease = document.getElementById('fontSizeDecrease');
        const fontSizeIncrease = document.getElementById('fontSizeIncrease');
        const currentFontSize = document.getElementById('currentFontSize');
        const autoScrollCheckbox = document.getElementById('autoScrollCheckbox');
        const hideHeaderCheckbox = document.getElementById('hideHeaderCheckbox');
        const pageContainer = document.getElementById('pageContainer');
        const chapterConfirm = document.getElementById('chapterConfirm');
        const confirmArrow = document.getElementById('confirmArrow');
        const confirmProgressElement = document.getElementById('confirmProgress');
        const networkStatus = document.getElementById('networkStatus');
        
        // องค์ประกอบใหม่สำหรับหน้ารายละเอียดมังงะ
        const mangaDetailCover = document.getElementById('mangaDetailCover');
        const mangaDetailTitle = document.getElementById('mangaDetailTitle');
        const mangaDetailAuthor = document.getElementById('mangaDetailAuthor');
        const mangaDetailStatus = document.getElementById('mangaDetailStatus');
        const mangaDetailGenre = document.getElementById('mangaDetailGenre');
        const mangaDetailDescription = document.getElementById('mangaDetailDescription');
        const chapterListContainer = document.getElementById('chapterListContainer');

        // Event Listeners
        homeLink.addEventListener('click', showHome);
        allMangaLink.addEventListener('click', showAllManga);
        historyLink.addEventListener('click', showHistory);
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
        prevChapterBtn.addEventListener('click', showPrevChapter);
        nextChapterBtn.addEventListener('click', showNextChapter);
        chapterSelect.addEventListener('change', changeChapter);
        prevPageBtn.addEventListener('click', showPrevPage);
        nextPageBtn.addEventListener('click', showNextPage);
        settingsButton.addEventListener('click', toggleSettingsMenu);
        scrollToTopBtn.addEventListener('click', scrollToTop);
        toggleSettingsBtn.addEventListener('click', toggleSettingsMenu);
        closeSettings.addEventListener('click', toggleSettingsMenu);
        menuPageMode.addEventListener('change', () => changeReadingMode('page'));
        menuWebtoonMode.addEventListener('change', () => changeReadingMode('webtoon'));
        lightMode.addEventListener('change', () => changeColorMode('light'));
        darkMode.addEventListener('change', () => changeColorMode('dark'));
        fontSizeDecrease.addEventListener('click', () => changeFontSize(-1));
        fontSizeIncrease.addEventListener('click', () => changeFontSize(1));
        autoScrollCheckbox.addEventListener('change', toggleAutoScroll);
        hideHeaderCheckbox.addEventListener('change', toggleHideHeader);
        document.addEventListener('scroll', handleScroll);
        chapterConfirm.addEventListener('mousedown', startConfirm);
        chapterConfirm.addEventListener('touchstart', startConfirm);
        document.addEventListener('mousemove', handleConfirmScroll);
        document.addEventListener('touchmove', handleConfirmScroll);
        document.addEventListener('mouseup', endConfirm);
        document.addEventListener('touchend', endConfirm);
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);
        
        // เริ่มต้นโหลดข้อมูล
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            showHome();
            loadSettings();
            updateNetworkStatus();
        });

        // ฟังก์ชันตรวจสอบสถานะเครือข่าย
        function updateNetworkStatus() {
            isOnline = navigator.onLine;
            if (isOnline) {
                networkStatus.textContent = 'กลับมาเชื่อมต่ออินเทอร์เน็ตแล้ว';
                networkStatus.classList.add('online');
                setTimeout(() => {
                    networkStatus.style.display = 'none';
                }, 3000);
                
                // ถ้ามีการเชื่อมต่อใหม่และอยู่ในโหมด Webtoon ให้ลองโหลดรูปภาพอีกครั้ง
                if (readerSection.style.display === 'block' && readingMode === 'webtoon') {
                    loadWebtoonMode();
                }
            } else {
                networkStatus.textContent = 'ไม่มีการเชื่อมต่ออินเทอร์เน็ต';
                networkStatus.classList.remove('online');
                networkStatus.style.display = 'block';
            }
        }

        // ฟังก์ชันตรวจสอบสถานะเครือข่ายเมื่อรูปภาพโหลดไม่สำเร็จ
        function checkNetworkStatus() {
            if (!isOnline) {
                networkStatus.textContent = 'ไม่มีการเชื่อมต่ออินเทอร์เน็ต';
                networkStatus.classList.remove('online');
                networkStatus.style.display = 'block';
            }
        }

        // ฟังก์ชันโหลดการตั้งค่า
        function loadSettings() {
            // โหมดการอ่าน
            const savedReadingMode = localStorage.getItem('readingMode') || 'page';
            readingMode = savedReadingMode;
            if (readingMode === 'page') {
                menuPageMode.checked = true;
            } else {
                menuWebtoonMode.checked = true;
            }

            // โหมดสี
            const savedColorMode = localStorage.getItem('colorMode') || 'light';
            if (savedColorMode === 'dark') {
                darkMode.checked = true;
                document.body.classList.add('dark-mode');
            } else {
                lightMode.checked = true;
                document.body.classList.remove('dark-mode');
            }

            // ขนาดตัวอักษร
            const savedFontSize = localStorage.getItem('fontSize') || 16;
            document.body.style.fontSize = savedFontSize + 'px';
            currentFontSize.textContent = savedFontSize + 'px';

            // การซ่อนแถบด้านบน
            const hideHeader = localStorage.getItem('hideHeader') === 'true';
            hideHeaderCheckbox.checked = hideHeader;
            if (hideHeader && readerSection.style.display === 'block') {
                toggleHeader(!hideHeader);
            }

            // เลื่อนอัตโนมัติ
            const autoScroll = localStorage.getItem('autoScroll') === 'true';
            autoScrollCheckbox.checked = autoScroll;
            if (autoScroll && readerSection.style.display === 'block' && readingMode === 'webtoon') {
                startAutoScroll();
            }
        }

        // ฟังก์ชันจัดการการเลื่อน
        function handleScroll() {
            if (readerSection.style.display !== 'block') return;
            
            updateProgressBar();
            
            if (readingMode !== 'webtoon') return;
            
            // ซ่อนแถบด้านบนเมื่อเลื่อนลง
            if (window.scrollY > 100 && isHeaderVisible) {
                toggleHeader(false);
            } else if (window.scrollY <= 100 && !isHeaderVisible) {
                toggleHeader(true);
            }
            
            // ตรวจสอบว่าถึงด้านล่างของหน้าแล้วหรือไม่
            const scrollPosition = window.scrollY + window.innerHeight;
            const pageHeight = document.body.scrollHeight;
            const threshold = 50;
            
            if (pageHeight - scrollPosition < threshold) {
                // แสดงลูกศรยืนยันเมื่อถึงด้านล่างสุดและยังมีตอนถัดไป
                if (currentChapterIndex < currentManga.chapters.length - 1 && !isConfirming) {
                    chapterConfirm.classList.add('show');
                }
            } else {
                if (!isConfirming) {
                    chapterConfirm.classList.remove('show');
                    confirmProgress = 0;
                    confirmProgressElement.style.transform = 'rotate(0deg)';
                }
            }
            
            // รีเซ็ต timeout สำหรับการซ่อนแถบ
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }
            
            scrollTimeout = setTimeout(() => {
                if (isHeaderVisible && window.scrollY > 100) {
                    toggleHeader(false);
                }
            }, 2000);
        }
        
        // ฟังก์ชันเริ่มยืนยันเปลี่ยนตอน
        function startConfirm(e) {
            if (currentChapterIndex >= currentManga.chapters.length - 1) return;
            
            isConfirming = true;
            startY = e.clientY || e.touches[0].clientY;
            e.preventDefault();
        }
        
        // ฟังก์ชันจัดการการเลื่อนสำหรับยืนยัน
        function handleConfirmScroll(e) {
            if (!isConfirming) return;
            
            const currentY = e.clientY || e.touches[0].clientY;
            const scrollDelta = startY - currentY;
            
            // คำนวณความคืบหน้า (0-100)
            confirmProgress = Math.min(Math.max(scrollDelta, 0), confirmThreshold);
            const rotation = (confirmProgress / confirmThreshold) * 360;
            
            // อัปเดตการแสดงผล
            confirmProgressElement.style.transform = `rotate(${rotation}deg)`;
            
            // ถ้าเลื่อนครบแล้วให้เปลี่ยนตอน
            if (confirmProgress >= confirmThreshold) {
                isConfirming = false;
                confirmArrow.classList.add('rotate-animation');
                
                setTimeout(() => {
                    showNextChapter();
                    chapterConfirm.classList.remove('show');
                    confirmArrow.classList.remove('rotate-animation');
                    confirmProgressElement.style.transform = 'rotate(0deg)';
                    confirmProgress = 0;
                }, 500);
            }
        }
        
        // ฟังก์ชันสิ้นสุดการยืนยัน
        function endConfirm() {
            if (!isConfirming) return;
            
            isConfirming = false;
            
            // รีเซ็ตความคืบหน้า
            if (confirmProgress < confirmThreshold) {
                confirmProgress = 0;
                confirmProgressElement.style.transform = 'rotate(0deg)';
                
                // ซ่อนลูกศรถ้ายังไม่ครบ
                const scrollPosition = window.scrollY + window.innerHeight;
                const pageHeight = document.body.scrollHeight;
                const threshold = 50;
                
                if (pageHeight - scrollPosition >= threshold) {
                    chapterConfirm.classList.remove('show');
                }
            }
        }

        // ฟังก์ชันอัปเดตแถบความคืบหน้า
        function updateProgressBar() {
            if (readerSection.style.display !== 'block') {
                progressContainer.style.display = 'none';
                return;
            }
            
            progressContainer.style.display = 'block';
            
            const scrollPosition = window.scrollY;
            const pageHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercentage = (scrollPosition / pageHeight) * 100;
            
            progressBar.style.width = scrollPercentage + '%';
        }

        // ฟังก์ชันเลื่อนขึ้นด้านบน
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // ฟังก์ชันเปิด/ปิดแถบด้านบน
        function toggleHeader(show = null) {
            if (show === null) {
                isHeaderVisible = !isHeaderVisible;
            } else {
                isHeaderVisible = show;
            }
            
            const header = document.querySelector('header');
            const chapterNav = document.getElementById('chapterNav');
            
            if (isHeaderVisible) {
                header.classList.remove('hidden');
                chapterNav.classList.remove('hidden');
            } else {
                header.classList.add('hidden');
                chapterNav.classList.add('hidden');
            }
        }

        // ฟังก์ชันเปิด/ปิดเมนูตั้งค่า
        function toggleSettingsMenu() {
            settingsMenu.classList.toggle('show');
        }

        // ฟังก์ชันเปลี่ยนโหมดการอ่าน
        function changeReadingMode(newMode) {
            if (readingMode === newMode) return;
            
            readingMode = newMode;
            
            // อัปเดต radio buttons
            if (readingMode === 'page') {
                menuPageMode.checked = true;
            } else {
                menuWebtoonMode.checked = true;
            }
            
            // บันทึกการตั้งค่าใน localStorage
            localStorage.setItem('readingMode', readingMode);
            
            // ถ้ากำลังอยู่ในหน้าอ่านมังงะ ให้เปลี่ยนโหมดทันที
            if (readerSection.style.display === 'block') {
                if (readingMode === 'webtoon') {
                    readerSection.classList.add('webtoon-mode');
                    loadWebtoonMode();
                    
                    // เริ่มเลื่อนอัตโนมัติหากเปิดไว้
                    if (autoScrollCheckbox.checked) {
                        startAutoScroll();
                    }
                } else {
                    readerSection.classList.remove('webtoon-mode');
                    stopAutoScroll();
                    
                    // รีเซ็ตตำแหน่งหน้าปัจจุบันและโหลดหน้าใหม่
                    currentPageIndex = 0;
                    
                    // ล้างและสร้าง page-container ใหม่
                    pageContainer.innerHTML = '';
                    
                    // สร้างองค์ประกอบใหม่
                    pageContainer.appendChild(readerLoading);
                    const img = document.createElement('img');
                    img.id = 'mangaPage';
                    img.className = 'manga-page';
                    img.alt = 'หน้ามังงะ';
                    img.onerror = function() {
                        this.onerror=null;
                        this.src='https://via.placeholder.com/800x1200?text=ไม่พบภาพ';
                        checkNetworkStatus();
                    };
                    pageContainer.appendChild(img);
                    
                    // อัปเดต DOM reference
                    mangaPage = document.getElementById('mangaPage');
                    
                    updatePage();
                }
            }
        }

        // ฟังก์ชันเปลี่ยนโหมดสี
        function changeColorMode(mode) {
            if (mode === 'dark') {
                document.body.classList.add('dark-mode');
                localStorage.setItem('colorMode', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('colorMode', 'light');
            }
        }

        // ฟังก์ชันเปลี่ยนขนาดตัวอักษร
        function changeFontSize(delta) {
            const currentSize = parseFloat(getComputedStyle(document.body).fontSize);
            const newSize = currentSize + delta;
            
            // จำกัดขนาดตัวอักษร
            if (newSize >= 12 && newSize <= 24) {
                document.body.style.fontSize = newSize + 'px';
                currentFontSize.textContent = newSize + 'px';
                localStorage.setItem('fontSize', newSize);
            }
        }

        // ฟังก์ชันสลับการซ่อนแถบด้านบน
        function toggleHideHeader() {
            const hideHeader = hideHeaderCheckbox.checked;
            localStorage.setItem('hideHeader', hideHeader);
            
            if (readerSection.style.display === 'block') {
                toggleHeader(!hideHeader);
            }
        }

        // ฟังก์ชันเลื่อนอัตโนมัติ
        function toggleAutoScroll() {
            const autoScroll = autoScrollCheckbox.checked;
            localStorage.setItem('autoScroll', autoScroll);
            
            if (autoScroll && readerSection.style.display === 'block' && readingMode === 'webtoon') {
                startAutoScroll();
            } else {
                stopAutoScroll();
            }
        }

        function startAutoScroll() {
            stopAutoScroll();
            
            if (readingMode !== 'webtoon') return;
            
            isAutoScrolling = true;
            pageContainer.classList.add('auto-scroll-active');
        }

        function stopAutoScroll() {
            isAutoScrolling = false;
            pageContainer.classList.remove('auto-scroll-active');
        }

        // ฟังก์ชันโหลดข้อมูลจาก GitHub Raw
        async function loadData() {
            try {
                const response = await fetch(RAW_DATA_URL);
                
                if (!response.ok) {
                    throw new Error('ไม่สามารถโหลดข้อมูลได้');
                }
                
                const data = await response.json();
                mangaData = data.manga || [];
                
                renderHomePage();
            } catch (error) {
                console.error('Error loading data:', error);
                featuredManga.innerHTML = '<div class="loading">โหลดข้อมูลไม่สำเร็จ</div>';
                checkNetworkStatus();
            }
        }
        
        // ฟังก์ชันแสดงหน้าแรก
        function showHome() {
            homeSection.style.display = 'block';
            allMangaSection.style.display = 'none';
            historySection.style.display = 'none';
            searchResultsSection.style.display = 'none';
            mangaDetailsSection.style.display = 'none';
            readerSection.style.display = 'none';
            renderHomePage();
        }
        
        // ฟังก์ชันแสดงมังงะทั้งหมด
        function showAllManga() {
            homeSection.style.display = 'none';
            allMangaSection.style.display = 'block';
            historySection.style.display = 'none';
            searchResultsSection.style.display = 'none';
            mangaDetailsSection.style.display = 'none';
            readerSection.style.display = 'none';
            renderAllManga();
        }

        // ฟังก์ชันแสดงประวัติการอ่าน
        function showHistory() {
            homeSection.style.display = 'none';
            allMangaSection.style.display = 'none';
            searchResultsSection.style.display = 'none';
            mangaDetailsSection.style.display = 'none';
            readerSection.style.display = 'none';
            historySection.style.display = 'block';
            
            renderHistory();
        }

        // ฟังก์ชันแสดงผลการค้นหา
        function showSearchResults() {
            homeSection.style.display = 'none';
            allMangaSection.style.display = 'none';
            historySection.style.display = 'none';
            mangaDetailsSection.style.display = 'none';
            searchResultsSection.style.display = 'block';
            readerSection.style.display = 'none';
            renderSearchResults();
        }
        
        // ฟังก์ชันแสดงรายละเอียดมังงะ
        function showMangaDetails(mangaId) {
            currentManga = mangaData.find(m => m.id === mangaId);
            if (!currentManga) return;

            homeSection.style.display = 'none';
            allMangaSection.style.display = 'none';
            historySection.style.display = 'none';
            searchResultsSection.style.display = 'none';
            mangaDetailsSection.style.display = 'block';
            readerSection.style.display = 'none';

            mangaDetailCover.src = currentManga.cover;
            mangaDetailTitle.textContent = currentManga.title;
            mangaDetailAuthor.textContent = `ผู้แต่ง: ${currentManga.author || 'ไม่ทราบ'}`;
            mangaDetailStatus.textContent = `สถานะ: ${currentManga.status || 'ไม่ทราบ'}`;
            mangaDetailGenre.textContent = `ประเภท: ${currentManga.genres?.join(', ') || 'ไม่ระบุ'}`;
            mangaDetailDescription.textContent = currentManga.description || 'ไม่มีรายละเอียด';

            renderChapterList();
        }
        
        // ฟังก์ชันแสดงรายการตอน
        function renderChapterList() {
            chapterListContainer.innerHTML = '';
            
            if (!currentManga.chapters || currentManga.chapters.length === 0) {
                chapterListContainer.innerHTML = '<div class="loading">ยังไม่มีตอน</div>';
                return;
            }
            
            const sortedChapters = [...currentManga.chapters].sort((a, b) => b.number - a.number);
            
            sortedChapters.forEach(chapter => {
                const chapterItem = document.createElement('div');
                chapterItem.className = 'chapter-item';
                
                const chapterInfo = document.createElement('div');
                chapterInfo.innerHTML = `
                    <div class="chapter-item-title">ตอนที่ ${chapter.number}${chapter.title ? ': ' + chapter.title : ''}</div>
                    ${chapter.date ? `<div class="chapter-item-date">อัปเดตเมื่อ: ${chapter.date}</div>` : ''}
                `;
                
                const readButton = document.createElement('button');
                readButton.className = 'read-button';
                readButton.textContent = 'อ่าน';
                readButton.onclick = () => showReader(currentManga.id, chapter.number);
                
                chapterItem.appendChild(chapterInfo);
                chapterItem.appendChild(readButton);
                chapterListContainer.appendChild(chapterItem);
            });
        }
        
        // ฟังก์ชันแสดง Reader
        function showReader(mangaId, chapterNumber) {
            currentManga = mangaData.find(m => m.id === mangaId);
            if (!currentManga) return;

            currentChapterIndex = currentManga.chapters.findIndex(c => c.number === chapterNumber);
            if (currentChapterIndex === -1) return;

            // บันทึกประวัติการอ่าน
            saveReadingHistory(mangaId, chapterNumber);

            homeSection.style.display = 'none';
            allMangaSection.style.display = 'none';
            historySection.style.display = 'none';
            searchResultsSection.style.display = 'none';
            mangaDetailsSection.style.display = 'none';
            readerSection.style.display = 'block';

            if (readingMode === 'webtoon') {
                readerSection.classList.add('webtoon-mode');
            } else {
                readerSection.classList.remove('webtoon-mode');
            }

            // ซ่อนแถบด้านบนเมื่อเริ่มอ่านหากตั้งค่าไว้
            if (hideHeaderCheckbox.checked) {
                toggleHeader(false);
            }

            loadChapter();
        }

        // ฟังก์ชันบันทึกประวัติการอ่าน
        function saveReadingHistory(mangaId, chapterNumber) {
            let history = JSON.parse(localStorage.getItem('readingHistory')) || [];
            
            // ลบรายการเดิมถ้ามี
            history = history.filter(item => item.mangaId !== mangaId);
            
            // เพิ่มรายการใหม่ที่ด้านบน
            history.unshift({
                mangaId: mangaId,
                chapterNumber: chapterNumber,
                timestamp: new Date().getTime()
            });
            
            // เก็บเพียง 50 รายการล่าสุด
            if (history.length > 50) {
                history = history.slice(0, 50);
            }
            
            localStorage.setItem('readingHistory', JSON.stringify(history));
        }

        // ฟังก์ชันแสดงประวัติการอ่าน
        function renderHistory() {
            const history = JSON.parse(localStorage.getItem('readingHistory')) || [];
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="loading">ยังไม่มีประวัติการอ่าน</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            history.forEach(item => {
                const manga = mangaData.find(m => m.id === item.mangaId);
                if (!manga) return;
                
                const chapter = manga.chapters.find(c => c.number === item.chapterNumber);
                if (!chapter) return;
                
                const historyCard = document.createElement('div');
                historyCard.className = 'manga-card';
                historyCard.onclick = () => showReader(manga.id, chapter.number);
                
                historyCard.innerHTML = `
                    <img src="${manga.cover}" alt="${manga.title}" onerror="this.src='https://via.placeholder.com/150x200?text=No+Image'">
                    <h3>${manga.title}</h3>
                    <p>ตอนที่ ${chapter.number}</p>
                    <p class="history-time">${formatTime(item.timestamp)}</p>
                `;
                
                historyList.appendChild(historyCard);
            });
        }

        // ฟังก์ชันจัดรูปแบบเวลา
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ฟังก์ชันค้นหา
        function performSearch() {
            const query = searchInput.value.trim().toLowerCase();
            if (!query) return;

            searchResults = [];

            mangaData.forEach(manga => {
                if (manga.title.toLowerCase().includes(query)) {
                    searchResults.push({
                        type: 'manga',
                        data: manga
                    });
                }

                manga.chapters.forEach(chapter => {
                    if (chapter.title && chapter.title.toLowerCase().includes(query)) {
                        searchResults.push({
                            type: 'chapter',
                            manga: manga,
                            chapter: chapter
                        });
                    }
                });
            });

            if (searchResults.length > 0) {
                showSearchResults();
            } else {
                alert('ไม่พบผลลัพธ์ที่ตรงกับการค้นหา');
            }
        }

        // ฟังก์ชันแสดงผลการค้นหา
        function renderSearchResults() {
            searchResultsContainer.innerHTML = '';

            if (searchResults.length === 0) {
                searchResultsContainer.innerHTML = '<div class="loading">ไม่พบผลลัพธ์</div>';
                return;
            }

            const mangaResults = searchResults.filter(item => item.type === 'manga');
            const chapterResults = searchResults.filter(item => item.type === 'chapter');

            if (mangaResults.length > 0) {
                const mangaSection = document.createElement('div');
                mangaSection.innerHTML = '<h3>มังงะที่พบ</h3>';
                
                const mangaGrid = document.createElement('div');
                mangaGrid.className = 'manga-grid';
                
                mangaResults.forEach(result => {
                    const mangaCard = createMangaCard(result.data);
                    mangaGrid.appendChild(mangaCard);
                });
                
                mangaSection.appendChild(mangaGrid);
                searchResultsContainer.appendChild(mangaSection);
            }

            if (chapterResults.length > 0) {
                const chapterSection = document.createElement('div');
                chapterSection.innerHTML = '<h3>ตอนที่พบ</h3>';
                
                const chapterList = document.createElement('div');
                chapterList.className = 'manga-grid';
                
                chapterResults.forEach(result => {
                    const chapterCard = document.createElement('div');
                    chapterCard.className = 'manga-card';
                    chapterCard.onclick = () => showReader(result.manga.id, result.chapter.number);
                    
                    chapterCard.innerHTML = `
                        <img src="${result.manga.cover}" alt="${result.manga.title}" onerror="this.src='https://via.placeholder.com/150x200?text=No+Image'">
                        <h3>${result.manga.title}</h3>
                        <p>ตอนที่ ${result.chapter.number}: ${result.chapter.title || ''}</p>
                    `;
                    
                    chapterList.appendChild(chapterCard);
                });
                
                chapterSection.appendChild(chapterList);
                searchResultsContainer.appendChild(chapterSection);
            }
        }

        // ฟังก์ชันโหลดตอน
        function loadChapter() {
            const chapter = currentManga.chapters[currentChapterIndex];
            chapterTitle.textContent = `${currentManga.title} - ตอนที่ ${chapter.number} ${chapter.title ? ': ' + chapter.title : ''}`;
            
            chapterSelect.innerHTML = '<option value="">เลือกตอน...</option>';
            currentManga.chapters.forEach((chap, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `ตอนที่ ${chap.number} ${chap.title ? ': ' + chap.title : ''}`;
                if (index === currentChapterIndex) option.selected = true;
                chapterSelect.appendChild(option);
            });
            
            currentPageIndex = 0;
            
            if (readingMode === 'webtoon') {
                loadWebtoonMode();
                // เลื่อนขึ้นด้านบนเมื่อโหลดตอนใหม่ในโหมด Webtoon
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                // เริ่มเลื่อนอัตโนมัติหากเปิดไว้
                if (autoScrollCheckbox.checked) {
                    startAutoScroll();
                }
            } else {
                stopAutoScroll();
                updatePage();
            }
            
            updateNavButtons();
        }

        // ฟังก์ชันโหลดโหมด Webtoon
        function loadWebtoonMode() {
            const chapter = currentManga.chapters[currentChapterIndex];
            const pageContainer = document.querySelector('.page-container');
            
            // ล้างหน้าทั้งหมด
            pageContainer.innerHTML = '';
            pageContainer.appendChild(readerLoading);
            
            // แสดง loading
            readerLoading.style.display = 'block';
            
            // สร้างและโหลดหน้าทั้งหมด
            chapter.pages.forEach((pageUrl, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.style.position = 'relative';
                
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'page-loading';
                loadingDiv.textContent = 'กำลังดาวน์โหลด...';
                
                const img = document.createElement('img');
                img.className = 'manga-page';
                img.src = pageUrl;
                img.alt = `หน้าที่ ${index + 1}`;
                img.onload = function() {
                    loadingDiv.style.display = 'none';
                };
                img.onerror = function() {
                    this.onerror=null;
                    this.src='https://via.placeholder.com/800x1200?text=ไม่พบภาพ';
                    loadingDiv.textContent = 'โหลดภาพไม่สำเร็จ';
                    checkNetworkStatus();
                };
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(loadingDiv);
                pageContainer.appendChild(imgContainer);
            });
            
            // ซ่อน loading เมื่อโหลดเสร็จ
            setTimeout(() => {
                readerLoading.style.display = 'none';
            }, 500);
        }

        // ฟังก์ชันเปลี่ยนตอนจาก dropdown
        function changeChapter() {
            const selectedIndex = parseInt(chapterSelect.value);
            if (!isNaN(selectedIndex) && selectedIndex >= 0 && selectedIndex < currentManga.chapters.length) {
                currentChapterIndex = selectedIndex;
                loadChapter();
            }
        }

        // ฟังก์ชันอัปเดตหน้า
        function updatePage() {
            const chapter = currentManga.chapters[currentChapterIndex];
            if (chapter.pages && chapter.pages.length > 0) {
                readerLoading.style.display = 'block';
                mangaPage.style.display = 'none';
                
                // ตั้งค่า src เพื่อเริ่มโหลดรูปภาพ
                mangaPage.src = chapter.pages[currentPageIndex];
                
                mangaPage.onload = function() {
                    readerLoading.style.display = 'none';
                    mangaPage.style.display = 'block';
                };
                
                mangaPage.onerror = function() {
                    this.onerror=null;
                    this.src='https://via.placeholder.com/800x1200?text=ไม่พบภาพ';
                    readerLoading.style.display = 'none';
                    mangaPage.style.display = 'block';
                    checkNetworkStatus();
                };
                
                pageInfo.textContent = `หน้า ${currentPageIndex + 1}/${chapter.pages.length}`;
            }
            updateNavButtons();
        }

        // ฟังก์ชันอัปเดตปุ่มนำทาง
        function updateNavButtons() {
            const chapter = currentManga.chapters[currentChapterIndex];
            
            prevChapterBtn.disabled = currentChapterIndex <= 0;
            nextChapterBtn.disabled = currentChapterIndex >= currentManga.chapters.length - 1;
            
            if (readingMode === 'page') {
                prevPageBtn.disabled = currentPageIndex <= 0;
                nextPageBtn.disabled = currentPageIndex >= chapter.pages.length - 1;
            }
        }

        // ฟังก์ชันเปลี่ยนหน้า
        function showPrevPage() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                updatePage();
            }
        }

        function showNextPage() {
            const chapter = currentManga.chapters[currentChapterIndex];
            if (currentPageIndex < chapter.pages.length - 1) {
                currentPageIndex++;
                updatePage();
            }
        }

        // ฟังก์ชันเปลี่ยนตอน
        function showPrevChapter() {
            if (currentChapterIndex > 0) {
                currentChapterIndex--;
                
                // หยุดการเลื่อนอัตโนมัติถ้ามี
                stopAutoScroll();
                
                loadChapter();
                
                // รีเซ็ตตำแหน่งการเลื่อน
                window.scrollTo({
                    top: 0,
                    behavior: 'auto'
                });
                
                // ถ้าเปิดโหมดเลื่อนอัตโนมัติอยู่ ให้เริ่มใหม่
                if (autoScrollCheckbox.checked) {
                    setTimeout(() => {
                        startAutoScroll();
                    }, 1000);
                }
            }
        }

        function showNextChapter() {
            if (currentChapterIndex < currentManga.chapters.length - 1) {
                currentChapterIndex++;
                
                // หยุดการเลื่อนอัตโนมัติถ้ามี
                stopAutoScroll();
                
                loadChapter();
                
                // รีเซ็ตตำแหน่งการเลื่อน
                window.scrollTo({
                    top: 0,
                    behavior: 'auto'
                });
                
                // ถ้าเปิดโหมดเลื่อนอัตโนมัติอยู่ ให้เริ่มใหม่
                if (autoScrollCheckbox.checked) {
                    setTimeout(() => {
                        startAutoScroll();
                    }, 1000);
                }
            }
        }

        // ฟังก์ชันแสดงหน้าแรก
        function renderHomePage() {
            featuredManga.innerHTML = '';
            
            if (mangaData.length === 0) {
                featuredManga.innerHTML = '<div class="loading">ยังไม่มีมังงะ</div>';
                return;
            }
            
            const shuffled = [...mangaData].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 4);
            
            selected.forEach(manga => {
                const mangaCard = createMangaCard(manga);
                featuredManga.appendChild(mangaCard);
            });
            
            recentUpdates.innerHTML = '';
            
            let allChapters = [];
            mangaData.forEach(manga => {
                manga.chapters.forEach(chapter => {
                    allChapters.push({
                        mangaId: manga.id,
                        mangaTitle: manga.title,
                        mangaCover: manga.cover,
                        chapter: chapter
                    });
                });
            });
            
            allChapters.sort((a, b) => b.chapter.number - a.chapter.number);
            
            allChapters.slice(0, 5).forEach(item => {
                const chapterCard = document.createElement('div');
                chapterCard.className = 'manga-card';
                chapterCard.onclick = () => showReader(item.mangaId, item.chapter.number);
                
                chapterCard.innerHTML = `
                    <img src="${item.mangaCover}" alt="${item.mangaTitle}" onerror="this.src='https://via.placeholder.com/150x200?text=No+Image'">
                    <h3>${item.mangaTitle}</h3>
                    <p>ตอนที่ ${item.chapter.number}</p>
                `;
                
                recentUpdates.appendChild(chapterCard);
            });
        }
        
        // ฟังก์ชันแสดงมังงะทั้งหมด
        function renderAllManga() {
            allMangaList.innerHTML = '';
            
            if (mangaData.length === 0) {
                allMangaList.innerHTML = '<div class="loading">ยังไม่มีมังงะ</div>';
                return;
            }
            
            mangaData.forEach(manga => {
                const mangaCard = createMangaCard(manga);
                allMangaList.appendChild(mangaCard);
            });
        }
        
        // ฟังก์ชันสร้างการ์ดมังงะ
        function createMangaCard(manga) {
            const card = document.createElement('div');
            card.className = 'manga-card';
            card.onclick = () => showMangaDetails(manga.id);
            
            card.innerHTML = `
                <img src="${manga.cover}" alt="${manga.title}" onerror="this.src='https://via.placeholder.com/150x200?text=No+Image'">
                <h3>${manga.title}</h3>
                <p>${manga.chapters?.length || 0} ตอน</p>
            `;
            
            return card;
        }
        
        // เปิดใช้งานฟังก์ชัน global
        window.showReader = showReader;
        window.showMangaDetails = showMangaDetails;
    </script>
</body>
</html>
