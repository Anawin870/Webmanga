<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MangaTH - เว็บอ่านมังงะ</title>
    <style>
        /* Reset และฟอนต์พื้นฐาน */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans Thai', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        /* Header */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        nav {
            display: flex;
            justify-content: center;
            padding: 0.5rem 0;
            background-color: #34495e;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover {
            background-color: #e74c3c;
        }

        /* Main Content */
        main {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            min-height: calc(100vh - 120px);
        }

        /* หน้าหลัก */
        .section-title {
            margin: 1.5rem 0;
            color: #2c3e50;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 0.5rem;
        }

        .manga-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .manga-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .manga-card:hover {
            transform: translateY(-5px);
        }

        .manga-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .manga-card h3 {
            padding: 0.5rem;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .manga-card p {
            padding: 0 0.5rem 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        /* หน้าอ่านมังงะ */
        .reader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 1rem 0;
            position: sticky;
            top: 60px;
            background-color: #f8f9fa;
            z-index: 90;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-button {
            padding: 0.5rem 1rem;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        .nav-button:hover {
            background-color: #e74c3c;
        }

        .nav-button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .chapter-title {
            text-align: center;
            margin: 0.5rem 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .page-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .manga-page {
            max-width: 100%;
            height: auto;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        .page-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .page-info {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 1rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #666;
        }

        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            main {
                padding: 0.5rem;
            }
            
            .manga-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .chapter-nav {
                top: 56px;
                padding: 0.5rem 0;
            }
            
            .nav-button {
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            
            .chapter-title {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>MangaTH</h1>
        <nav>
            <a href="#" id="homeLink">หน้าแรก</a>
            <a href="#" id="allMangaLink">มังงะทั้งหมด</a>
        </nav>
    </header>

    <main id="mainContent">
        <!-- หน้าแรก -->
        <section id="homeSection">
            <h2 class="section-title">เรื่องแนะนำ</h2>
            <div class="manga-grid" id="featuredManga">
                <div class="loading">กำลังโหลดข้อมูล...</div>
            </div>

            <h2 class="section-title">อัปเดตล่าสุด</h2>
            <div class="manga-grid" id="recentUpdates">
                <div class="loading">กำลังโหลดข้อมูล...</div>
            </div>
        </section>

        <!-- หน้ามังงะทั้งหมด -->
        <section id="allMangaSection" style="display: none;">
            <h2 class="section-title">มังงะทั้งหมด</h2>
            <div class="manga-grid" id="allMangaList">
                <div class="loading">กำลังโหลดข้อมูล...</div>
            </div>
        </section>

        <!-- หน้าอ่านมังงะ -->
        <section id="readerSection" style="display: none;">
            <div class="reader-container">
                <div class="chapter-nav">
                    <button id="prevChapterBtn" class="nav-button">← ตอนก่อนหน้า</button>
                    <h2 class="chapter-title" id="chapterTitle">ชื่อตอน</h2>
                    <button id="nextChapterBtn" class="nav-button">ตอนถัดไป →</button>
                </div>

                <div class="page-info" id="pageInfo">หน้า 1/10</div>
                
                <div class="page-container">
                    <img id="mangaPage" class="manga-page" src="" alt="หน้ามังงะ" onerror="this.src='https://via.placeholder.com/800x1200?text=ไม่พบภาพ'">
                </div>

                <div class="page-controls">
                    <button id="prevPageBtn" class="nav-button">← หน้าก่อน</button>
                    <button id="nextPageBtn" class="nav-button">หน้าถัดไป →</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 MangaTH - เว็บอ่านมังงะเเปลไทย</p>
    </footer>

    <script>
        // กำหนดค่า GitHub Repository
        const GITHUB_USERNAME = 'Anawin870'; // เปลี่ยนเป็นชื่อ GitHub ของคุณ
        const GITHUB_REPO = 'Webmanga';     // เปลี่ยนเป็นชื่อ repository ของคุณ
        const DATA_FILE = 'manga-data.json'; // ต้องตรงกับชื่อไฟล์ใน repository
        
        // URL สำหรับดึงข้อมูล
        const RAW_DATA_URL = `https://raw.githubusercontent.com/Anawin870/Webmanga2/refs/heads/main/manga-data.json`;
        
        // ตัวแปรเก็บข้อมูล
        let mangaData = [];
        let currentManga = null;
        let currentChapterIndex = 0;
        let currentPageIndex = 0;

        // DOM Elements
        const homeLink = document.getElementById('homeLink');
        const allMangaLink = document.getElementById('allMangaLink');
        const homeSection = document.getElementById('homeSection');
        const allMangaSection = document.getElementById('allMangaSection');
        const readerSection = document.getElementById('readerSection');
        const featuredManga = document.getElementById('featuredManga');
        const recentUpdates = document.getElementById('recentUpdates');
        const allMangaList = document.getElementById('allMangaList');
        const chapterTitle = document.getElementById('chapterTitle');
        const mangaPage = document.getElementById('mangaPage');
        const pageInfo = document.getElementById('pageInfo');
        const prevChapterBtn = document.getElementById('prevChapterBtn');
        const nextChapterBtn = document.getElementById('nextChapterBtn');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');

        // Event Listeners
        homeLink.addEventListener('click', showHome);
        allMangaLink.addEventListener('click', showAllManga);
        prevChapterBtn.addEventListener('click', showPrevChapter);
        nextChapterBtn.addEventListener('click', showNextChapter);
        prevPageBtn.addEventListener('click', showPrevPage);
        nextPageBtn.addEventListener('click', showNextPage);

        // ฟังก์ชันโหลดข้อมูลจาก GitHub Raw
        async function loadData() {
            try {
                const response = await fetch(RAW_DATA_URL);
                
                if (!response.ok) {
                    throw new Error('ไม่สามารถโหลดข้อมูลได้');
                }
                
                const data = await response.json();
                mangaData = data.manga || [];
                
                renderHomePage();
            } catch (error) {
                console.error('Error loading data:', error);
                featuredManga.innerHTML = '<div class="loading">โหลดข้อมูลไม่สำเร็จ</div>';
            }
        }
        
        // ฟังก์ชันแสดงหน้าแรก
        function showHome() {
            homeSection.style.display = 'block';
            allMangaSection.style.display = 'none';
            readerSection.style.display = 'none';
            renderHomePage();
        }
        
        // ฟังก์ชันแสดงมังงะทั้งหมด
        function showAllManga() {
            homeSection.style.display = 'none';
            allMangaSection.style.display = 'block';
            readerSection.style.display = 'none';
            renderAllManga();
        }
        
        // ฟังก์ชันแสดง Reader
        function showReader(mangaId, chapterNumber) {
            currentManga = mangaData.find(m => m.id === mangaId);
            if (!currentManga) return;

            currentChapterIndex = currentManga.chapters.findIndex(c => c.number === chapterNumber);
            if (currentChapterIndex === -1) return;

            homeSection.style.display = 'none';
            allMangaSection.style.display = 'none';
            readerSection.style.display = 'block';

            loadChapter();
        }

        // ฟังก์ชันโหลดตอน
        function loadChapter() {
            const chapter = currentManga.chapters[currentChapterIndex];
            chapterTitle.textContent = `${currentManga.title} - ตอนที่ ${chapter.number} ${chapter.title ? ': ' + chapter.title : ''}`;
            
            currentPageIndex = 0;
            updatePage();
            updateNavButtons();
        }

        // ฟังก์ชันอัปเดตหน้า
        function updatePage() {
            const chapter = currentManga.chapters[currentChapterIndex];
            if (chapter.pages && chapter.pages.length > 0) {
                mangaPage.src = chapter.pages[currentPageIndex];
                pageInfo.textContent = `หน้า ${currentPageIndex + 1}/${chapter.pages.length}`;
            }
            updateNavButtons();
        }

        // ฟังก์ชันอัปเดตปุ่มนำทาง
        function updateNavButtons() {
            const chapter = currentManga.chapters[currentChapterIndex];
            
            // ปุ่มตอน
            prevChapterBtn.disabled = currentChapterIndex <= 0;
            nextChapterBtn.disabled = currentChapterIndex >= currentManga.chapters.length - 1;
            
            // ปุ่มหน้า
            prevPageBtn.disabled = currentPageIndex <= 0;
            nextPageBtn.disabled = currentPageIndex >= chapter.pages.length - 1;
        }

        // ฟังก์ชันเปลี่ยนหน้า
        function showPrevPage() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                updatePage();
            }
        }

        function showNextPage() {
            const chapter = currentManga.chapters[currentChapterIndex];
            if (currentPageIndex < chapter.pages.length - 1) {
                currentPageIndex++;
                updatePage();
            }
        }

        // ฟังก์ชันเปลี่ยนตอน
        function showPrevChapter() {
            if (currentChapterIndex > 0) {
                currentChapterIndex--;
                loadChapter();
            }
        }

        function showNextChapter() {
            if (currentChapterIndex < currentManga.chapters.length - 1) {
                currentChapterIndex++;
                loadChapter();
            }
        }

        // ฟังก์ชันแสดงหน้าแรก
        function renderHomePage() {
            // แสดงเรื่องแนะนำ (สุ่มมา 4 เรื่อง)
            featuredManga.innerHTML = '';
            
            if (mangaData.length === 0) {
                featuredManga.innerHTML = '<div class="loading">ยังไม่มีมังงะ</div>';
                return;
            }
            
            // สุ่มเลือกมังงะมาแสดง
            const shuffled = [...mangaData].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 4);
            
            selected.forEach(manga => {
                const mangaCard = createMangaCard(manga);
                featuredManga.appendChild(mangaCard);
            });
            
            // แสดงอัปเดตล่าสุด (5 ตอนล่าสุด)
            recentUpdates.innerHTML = '';
            
            // รวบรวมทุกตอนจากทุกมังงะ
            let allChapters = [];
            mangaData.forEach(manga => {
                manga.chapters.forEach(chapter => {
                    allChapters.push({
                        mangaId: manga.id,
                        mangaTitle: manga.title,
                        mangaCover: manga.cover,
                        chapter: chapter
                    });
                });
            });
            
            // เรียงตามเลขตอน (จากมากไปน้อย)
            allChapters.sort((a, b) => b.chapter.number - a.chapter.number);
            
            // แสดง 5 ตอนล่าสุด
            allChapters.slice(0, 5).forEach(item => {
                const chapterCard = document.createElement('div');
                chapterCard.className = 'manga-card';
                chapterCard.onclick = () => showReader(item.mangaId, item.chapter.number);
                
                chapterCard.innerHTML = `
                    <img src="${item.mangaCover}" alt="${item.mangaTitle}" onerror="this.src='https://via.placeholder.com/150x200?text=No+Image'">
                    <h3>${item.mangaTitle}</h3>
                    <p>ตอนที่ ${item.chapter.number}</p>
                `;
                
                recentUpdates.appendChild(chapterCard);
            });
        }
        
        // ฟังก์ชันแสดงมังงะทั้งหมด
        function renderAllManga() {
            allMangaList.innerHTML = '';
            
            if (mangaData.length === 0) {
                allMangaList.innerHTML = '<div class="loading">ยังไม่มีมังงะ</div>';
                return;
            }
            
            mangaData.forEach(manga => {
                const mangaCard = createMangaCard(manga);
                allMangaList.appendChild(mangaCard);
            });
        }
        
        // ฟังก์ชันสร้างการ์ดมังงะ
        function createMangaCard(manga) {
            const card = document.createElement('div');
            card.className = 'manga-card';
            card.onclick = () => showMangaDetails(manga.id);
            
            card.innerHTML = `
                <img src="${manga.cover}" alt="${manga.title}" onerror="this.src='https://via.placeholder.com/150x200?text=No+Image'">
                <h3>${manga.title}</h3>
                <p>${manga.chapters?.length || 0} ตอน</p>
            `;
            
            return card;
        }
        
        // ฟังก์ชันแสดงรายละเอียดมังงะ
        function showMangaDetails(mangaId) {
            const manga = mangaData.find(m => m.id === mangaId);
            if (!manga) return;
            
            // สร้าง Modal หรือเปลี่ยนหน้าเพื่อแสดงรายละเอียด
            // ในที่นี้เราจะแสดงตอนแรกของมังงะนั้น
            if (manga.chapters && manga.chapters.length > 0) {
                showReader(mangaId, manga.chapters[0].number);
            } else {
                alert('มังงะนี้ยังไม่มีตอน');
            }
        }
        
        // เปิดใช้งานฟังก์ชัน global
        window.showReader = showReader;
        window.showMangaDetails = showMangaDetails;

        // เริ่มต้นโหลดข้อมูล
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            showHome();
        });
    </script>
</body>
</html>
